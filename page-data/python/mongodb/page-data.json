{"componentChunkName":"component---src-templates-blog-post-js","path":"/python/mongodb/","result":{"data":{"site":{"siteMetadata":{"title":"Tectac","author":"David Briggs"}},"markdownRemark":{"id":"712182d2-64c7-57ee-b81b-113e761e5dcd","excerpt":"Change examples my own dB Working with python and mongodb on windows desktop. Create a docker hosted MongoDB database Install PyMongo, the Python Driver Connect…","html":"<p>Change examples my own dB</p>\n<p>Working with python and mongodb on windows desktop.</p>\n<ul>\n<li>Create a docker hosted MongoDB database</li>\n<li>Install PyMongo, the Python Driver</li>\n<li>Connect to MongoDB</li>\n<li>Explore MongoDB Collections and Documents</li>\n<li>Perform basic Create, Retrieve, Update and Delete (CRUD) operations using PyMongo</li>\n<li>Build imports for CSV files  to mongo collections.</li>\n</ul>\n<h2>PyMongo</h2>\n<p>PyMongo is the official Python driver for MongoDB\nsee <a href=\"#1\">1</a></p>\n<h3>Installation</h3>\n<p>python -m pip install pymongo</p>\n<h3>Connection to database</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient\n<span class=\"token keyword\">from</span> pprint <span class=\"token keyword\">import</span> pprint\n<span class=\"token comment\"># connect to MongoDB, change the &lt;&lt; MONGODB URL >> to reflect your own connection string</span>\nclient <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;&lt;</span>MONGODB URL<span class=\"token operator\">>></span><span class=\"token punctuation\">)</span>\ndb<span class=\"token operator\">=</span>client<span class=\"token punctuation\">.</span>admin\n<span class=\"token comment\"># Issue the serverStatus command and print the results</span>\nserverStatusResult<span class=\"token operator\">=</span>db<span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">(</span><span class=\"token string\">\"serverStatus\"</span><span class=\"token punctuation\">)</span>\npprint<span class=\"token punctuation\">(</span>serverStatusResult<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Basic CRUD operations using PyMongo</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient\nclient <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span>'<span class=\"token operator\">&lt;&lt;</span>MongoDB URL<span class=\"token operator\">>></span>’<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># create database</span>\ndb <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>business\n<span class=\"token comment\">#Step 2: Create sample data</span>\nnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Kitchen'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Animal'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Tastey'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Big'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'City'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Fish'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Pizza'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Goat'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Salty'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Sandwich'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Lazy'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Fun'</span><span class=\"token punctuation\">]</span>\ncompany_type <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'LLC'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Inc'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Company'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Corporation'</span><span class=\"token punctuation\">]</span>\ncompany_cuisine <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Pizza'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Bar Food'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Fast Food'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Italian'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mexican'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'American'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sushi Bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Vegetarian'</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">501</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    business <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'name'</span> <span class=\"token punctuation\">:</span> names<span class=\"token punctuation\">[</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> names<span class=\"token punctuation\">[</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> company_type<span class=\"token punctuation\">[</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>company_type<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'rating'</span> <span class=\"token punctuation\">:</span> randint<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'cuisine'</span> <span class=\"token punctuation\">:</span> company_cuisine<span class=\"token punctuation\">[</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>company_cuisine<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">#Step 3: Insert business object directly into MongoDB via insert_one</span>\n    result<span class=\"token operator\">=</span>db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>insert_one<span class=\"token punctuation\">(</span>business<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">#Step 4: Print to the console the ObjectID of the new document</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Created {0} of 500 as {1}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>result<span class=\"token punctuation\">.</span>inserted_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#Step 5: Tell us that you are done</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finished creating 500 business reviews'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Find operations</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\">fivestar <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>find_one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'rating'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>fivestar<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#</span>\nfivestarcount <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'rating'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>fivestarcount<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Aggreation pipeline</h2>\n<p>MongoDB aggregation pipeline :</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient\n<span class=\"token comment\"># Connect to the MongoDB, change the connection string per your MongoDB environment</span>\nclient <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span>port<span class=\"token operator\">=</span><span class=\"token number\">27017</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Set the db object to point to the business database</span>\ndb<span class=\"token operator\">=</span>client<span class=\"token punctuation\">.</span>business\n<span class=\"token comment\"># Showcasing the count() method of find, count the total number of 5 ratings</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The number of 5 star reviews:'</span><span class=\"token punctuation\">)</span>\nfivestarcount <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'rating'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>fivestarcount<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Now let's use the aggregation framework to sum the occurrence of each rating across the entire data set</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\nThe sum of each rating occurance across all data grouped by rating '</span><span class=\"token punctuation\">)</span>\nstargroup<span class=\"token operator\">=</span>db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span>\n<span class=\"token comment\"># The Aggregation Pipeline is defined as an array of different operations</span>\n<span class=\"token punctuation\">[</span>\n<span class=\"token comment\"># The first stage in this pipe is to group data</span>\n<span class=\"token punctuation\">{</span> <span class=\"token string\">'$group'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$rating\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token string\">\"count\"</span> <span class=\"token punctuation\">:</span>\n                 <span class=\"token punctuation\">{</span> <span class=\"token string\">'$sum'</span> <span class=\"token punctuation\">:</span><span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\"># The second stage in this pipe is to sort the data</span>\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"$sort\"</span><span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">{</span> <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\"># Close the array with the ] tag</span>\n<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Print the result</span>\n<span class=\"token keyword\">for</span> group <span class=\"token keyword\">in</span> stargroup<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>group<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Update operation with PyMongo</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient\n<span class=\"token comment\">#include pprint for readabillity of the</span>\n<span class=\"token keyword\">from</span> pprint <span class=\"token keyword\">import</span> pprint\n\n<span class=\"token comment\">#change the MongoClient connection string to your MongoDB database instance</span>\nclient <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span>port<span class=\"token operator\">=</span><span class=\"token number\">27020</span><span class=\"token punctuation\">)</span>\ndb<span class=\"token operator\">=</span>client<span class=\"token punctuation\">.</span>business\n\nASingleReview <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>find_one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A sample document:'</span><span class=\"token punctuation\">)</span>\npprint<span class=\"token punctuation\">(</span>ASingleReview<span class=\"token punctuation\">)</span>\n\nresult <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>update_one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'_id'</span> <span class=\"token punctuation\">:</span> ASingleReview<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'_id'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'$inc'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'likes'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Number of documents modified : '</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>modified_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nUpdatedDocument <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>reviews<span class=\"token punctuation\">.</span>find_one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span>ASingleReview<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The updated document:'</span><span class=\"token punctuation\">)</span>\npprint<span class=\"token punctuation\">(</span>UpdatedDocument<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>Deleting documents</h4>\n<p> the delete<em>one and delete</em>many command takes a query that matches the document to delete as the first parameter.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\">result <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span>restaurants<span class=\"token punctuation\">.</span>delete_many<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>“category”<span class=\"token punctuation\">:</span> “Bar Food“<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Resources</h2>\n<p><a name=\"1\"></a><a href=\"https://docs.mongodb.com/drivers/python\">PyMongo drivers</a>\n<a name=\"2\"></a><a href=\"https://university.mongodb.com/courses/M101P/about\">Mongo course</a></p>","frontmatter":{"title":"Python and Mongodb","date":"2021, Sep 11","tags":["python","mongodb"],"img":null}}},"pageContext":{"slug":"/python/mongodb/","previous":{"fields":{"slug":"/git/"},"frontmatter":{"title":"Git Recipes","tags":["git Cheatsheet","git"],"img":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABZnagoCwz/8QAGRAAAwADAAAAAAAAAAAAAAAAAQIDABIx/9oACAEBAAEFAlkoyyjRIoVHO5Rzv//EABcRAQADAAAAAAAAAAAAAAAAAAACERL/2gAIAQMBAT8BpqL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQIBAT8Bqa//xAAbEAACAQUAAAAAAAAAAAAAAAAAAREQISIycf/aAAgBAQAGPwI1nhlZ0hjg/8QAGhABAAIDAQAAAAAAAAAAAAAAAQAhETFBUf/aAAgBAQABPyHbZSPo2aKQUl6ixZhCtknEAr2f/9oADAMBAAIAAwAAABCzL//EABYRAQEBAAAAAAAAAAAAAAAAABEAIf/aAAgBAwEBPxAEOF//xAAWEQEBAQAAAAAAAAAAAAAAAAARACH/2gAIAQIBAT8QTPrf/8QAGxABAAIDAQEAAAAAAAAAAAAAAQARMUFhIVH/2gAIAQEAAT8QRK6wtBC/UqIt73ZDn5KdTJGqeYvUSCtUF8B1n//Z"},"images":{"fallback":{"src":"/static/d0638a9c17107dbd01665305ccfe940a/1eb4c/software.jpg","srcSet":"/static/d0638a9c17107dbd01665305ccfe940a/53c59/software.jpg 750w,\n/static/d0638a9c17107dbd01665305ccfe940a/64b93/software.jpg 1080w,\n/static/d0638a9c17107dbd01665305ccfe940a/1eb4c/software.jpg 1280w","sizes":"100vw"},"sources":[{"srcSet":"/static/d0638a9c17107dbd01665305ccfe940a/3970f/software.webp 750w,\n/static/d0638a9c17107dbd01665305ccfe940a/90a5d/software.webp 1080w,\n/static/d0638a9c17107dbd01665305ccfe940a/a02e4/software.webp 1280w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.665625}}}}},"next":{"fields":{"slug":"/hugo/websitechecklist/"},"frontmatter":{"title":"Check list for Hugo website","tags":["Hugo","static website"],"img":null}}}},"staticQueryHashes":["2478211480","63159454"]}