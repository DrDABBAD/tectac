{"componentChunkName":"component---src-templates-blog-post-js","path":"/raspberrypi/pi3/Gatewayrouter/","result":{"data":{"site":{"siteMetadata":{"title":"Tectac","author":"David Briggs"}},"markdownRemark":{"id":"b3ca781e-45b8-54ca-86fb-97d0470bb95e","excerpt":"Materials Build tasks Create imaging  https://www.raspberrypi.org/documentation/installation/installing-images/\n(Be sure to download the Raspbian Jessie Lite…","html":"<h2>Materials</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Raspberry PI 3\nUSB-to-Ethernet Adapter (I used an Ultralink UL-USB02-EN)\nRPi Power Supply\n16Gb MicroSD Card\nPeripherals to do setup (display, mouse, keyboard)</code></pre></div>\n<h2>Build tasks</h2>\n<ol>\n<li>\n<p>Create imaging  <a href=\"https://www.raspberrypi.org/documentation/installation/installing-images/\">https://www.raspberrypi.org/documentation/installation/installing-images/</a>\n(Be sure to download the Raspbian Jessie Lite image (Not NOOBS)).  ??? Check current versions for this</p>\n<p>REset DEfault loign How?</p>\n</li>\n<li>\n<p>Basic configuration</p>\n<ul>\n<li>\n<p>Update image</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Sudo Su\napt-get update; apt-get -y upgrade</code></pre></div>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">* configure host name</code></pre></div>\n<p>echo \"gateway.butterworth\" > /etc/hostname; bash;\nroot@gateway:/home/pi#</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">* Create yourself a user other than pi, although using an ssh key and disabling all password authentication may be better.</code></pre></div>\n</li>\n<li>\n<p>Configure interface for gate way router</p>\n<ul>\n<li>\n<p>Check current config</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ifconfig | grep eth</code></pre></div>\n<p>Expect\neth0  Link encap:Ethernet  HWaddr b8:27:eb:9a:a1:62\neth1      Link encap:Ethernet  HWaddr 00:e0:4c:53:44:58</p>\n</li>\n<li>configure these in /etc/dhcpcd.conf  (This is specfic to PI)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nano /etc/dhcpcd.conf#Add the following lines\n\tinterface eth1\n\tstatic ip_address=10.0.0.1\n\tstatic routers=10.0.0.1\n\tstatic domain_name_servers=10.0.0.1,8.8.8.8</code></pre></div>\n<p>/etc/init.d/networking restart  may not reconfig interface correctly\nHence use\nsudo reboot</p>\n<p>Check Ifconfig again</p>\n<p>Expect: etho has assighed address for external router exth has internal route</p>\n</li>\n<li>\n<p>DHCP server setup</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apt-get install -y isc-dhcp-server</code></pre></div>\n<p>let’s configure it —</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nano /etc/dhcp/dhcpd.conf#add the following to the endsubnet 10.0.0.0 netmask 255.255.255.0 {    range 10.0.0.10 10.0.0.50;\noption domain-name-servers 10.0.0.1, 8.8.8.8;\noption domain-name &quot;butterworth&quot;;\noption routers 10.0.0.1;\noption broadcast-address 10.0.0.255;\ndefault-lease-time 600;\nmax-lease-time 7200;}</code></pre></div>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  Restart service\n  /etc/init.d/isc-dhcp-server restart\n\n5. Iptable routing\n\n   NEED  NOTES ON IPTABLESHERE\n\n    we use iptables :\n\niptables -F\niptables -t nat -F\niptables -t mangle -F\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\niptables -A FORWARD -i eth1 -j ACCEPT\nmkdir /etc/iptables; iptables-save &gt; /etc/iptables/rules.v4\n\n\n\nBut this will not persist across reboots. So we add a line to rc.local to restore like so :\n\nnano /etc/rc.local\n#add the following (BEFORE THE exit 0)iptables-restore /etc/iptables/rules.v4exit 0\n\n\nTESt buy ping to google\n\n\n6. Add Traffic GUI\n\nA network traffic GUI — ntoppng — ( http://www.ntop.org ) :\n\napt-get install -y ntopng</code></pre></div>","frontmatter":{"title":"","date":null,"tags":null,"img":null}}},"pageContext":{"slug":"/raspberrypi/pi3/Gatewayrouter/","previous":{"fields":{"slug":"/apache/"},"frontmatter":{"title":"","tags":null,"img":null}},"next":null}},"staticQueryHashes":["2478211480","63159454"]}